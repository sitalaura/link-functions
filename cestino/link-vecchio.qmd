---
title: "Are we getting interactions wrong? <br> The role of link functions <br> in psychological research"
authors: "Laura Sità, Margherita Calderan, Tommaso Feraco, <br> Filippo Gambarota, Enrico Toffalini"
format:
  revealjs:
    center: true
    embed-resources: true
    slide-number: true
    footer: "Cognitive Science Arena 2026"
    # theme: night
    output-file: "link-functions.html"
toc: true
execute:
  cache: false
  freeze: false
include-in-header:
  - text: |
      <style>
      /* Titolo slide di copertina */
      #title-slide .title {
        font-size: 1.5em;
       <!-- color: #900000; --> 
      }

      /* Logo nella copertina */
      #title-slide::after {
        content: "";
        display: block;
        background-image: url("images/logo.png");
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
        height: 250px;
        margin-top: 1.5em;
      }

      /* Titoli interni delle slide */
      .reveal h1, .reveal h2, .reveal h3 {
      <!--  color: #900000 !important; -->
      }

      /* Dimensione leggermente minore per h2 */
      .reveal h2 {
        font-size: 1.2em !important;
      }

      /* testo giustificato */
      .reveal p, .reveal li {
        text-align: justify !important;
        text-justify: inter-word;
      }

      /* footer centrato */
       .reveal .slide-footer,
      .reveal .footer,
      .reveal .revealjs-footer {
        position: fixed; left: 0; right: 0; bottom: 10px;
        width: 100%;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        text-align: center !important;
      }
      </style>
---

# 

```{r source}
#| echo: false
#| include: false
source("R/datasim.R")
ts <- 16
tc <- "black"
```

per chi vuole provare a simulare le cose in tempo reale

qr code che manda a questo link https://github.com/sitalaura/link-functions/tree/main/R

oppure scaricare il file a questo percorso `sitalaura.github.io/link-functions/R/datasim.R`

# 1 Example

## Simulated dataset 1

independent variable: age in years (`years`)

dependent variable: (`variabile`)

**aggiungi screenshot dataset**

## Linear model

using the classical linear predictor

```{r ex1fitL}
#| echo: true
#| eval: false
fitL = glm(y~age, data=d)
```

## Linear model

what we dont see it bc its a default parameter but its actually hidden in our code:

```{r fitL-link}
#| echo: true
#| eval: false
#| code-fold: true
fitL_explicit = glm(y~age, family=gaussian(link="identity"), data=d)
```

::: fragment
the model uses family gaussian and the identity link function
:::

::: fragment
**link function** in GLMs transforms (re-map) the linear predictor X

to the appropriate range of the response variable Y
:::

## Identity link function

equal intervals on X correspond to equal intervals on Y

su x ed y metti i nomi delle variabili dell'esempio

```{r idlink}
#| echo: false
#| fig.align: "center" 

df_line <- data.frame(
  x = seq(-4.5, 4.5, length.out = 200)
)
df_line$y <- df_line$x


x_vals <- -4:4
y_vals <- -4:4

ggplot(df_line, aes(x = x, y = y)) +
  geom_hline(
    yintercept = y_vals,
    color = "grey60",
    linewidth = 0.6
  ) +
  geom_vline(
    xintercept = x_vals,
    color = "red",
    linetype = "dashed",
    linewidth = 0.6
  ) +
  geom_line(
    color = "blue",
    linewidth = 2
  ) +
  scale_x_continuous(
    limits = c(-4.5, 4.5),
    breaks = x_vals
  ) +
  scale_y_continuous(
    limits = c(-4.5, 4.5),
    breaks = y_vals
  ) +
  
  # Etichette
  labs(
    x = "Age (years)",
    y = "vd (boh)"
  ) +
  theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(face = "bold", color = "steelblue", size = 26),
    plot.subtitle = element_text(size = 18),
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )
```

# 2 Example

## Simulated dataset 2

independent variable: age in years (`years`)

dependent variable: mistakes in a reading task (`errors`)

**aggiungi screenshot dataset**

## Linear model

using the classical linear predictor

```{r fitL}
#| echo: true
#| eval: false
fitL = glm(y~age, data=d)
```

## Linear model

```{r fitL-plot}
#| echo: true
#| code-fold: true
fitL = glm(y~age, data=d)
effL = data.frame(allEffects(fitL,xlevels=list(age=seq(min(age),max(age),.05)))$"age")
ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effL,aes(y=fit),size=2,color="darkred")+
  geom_ribbon(data=effL,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="darkred")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")
```

## ❌ Wrong link function

IN THE FIRST EXAMPLE an identity link was appropriate bc

-   y (`boh`) spans from -inf to +inf

::: fragment
here an identity link is NOT appropriate bc

-   y (`errors`) spans from 0 to +inf
:::

::: notes
family is also wrong but doesnt concern what we're talking about
:::

## ✅ Log link function

equal intervals on X correspond to equal ratios (NOT equal intervals) on Y

```{r loglink}
#| echo: false
#| warning: false
#| fig.align: "center" 

df <- data.frame(
  x = seq(-2.2, 1.6, length.out = 300)
)
df$y <- exp(df$x)

x_vals <- seq(-1.5, 1.5, by = 0.5)
y_vals <- exp(x_vals)

ggplot(df, aes(x = x, y = y)) +
  geom_hline(
    yintercept = y_vals,
    color = "grey60",
    linewidth = 0.6
  ) +
  geom_vline(
    xintercept = x_vals,
    color = "red",
    linetype = "dashed",
    linewidth = 0.6
  ) +
  geom_line(
    color = "blue",
    linewidth = 2
  ) +
  annotate(
    "text",
    x = -2.25,
    y = y_vals,
    label = paste("y =", round(y_vals, 2)),
    hjust = 1,
    size = 4
  ) +
  annotate(
    "text",
    x = x_vals,
    y = -0.08,
    label = paste("x =", x_vals),
    vjust = 1,
    size = 4
  ) +
  scale_x_continuous(
    limits = c(-2.2, 1.6),
    breaks = x_vals
  ) +
  scale_y_continuous(
    limits = c(0, max(y_vals) + 0.8),
    breaks = y_vals
  ) +
  labs(
    x = "Age (years)",
    y = "Reading mistakes (errors)"
  ) +
  theme_minimal(base_size = 18) +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )
```

## ✅ Appropriate model

using the appropriate distribution `family=poisson`

and **the appropriate link**

```{r fitP}
#| echo: true
#| eval: false
fitP = glm(y~age, family=poisson(link="log"), data=d)
```

in this case, `link="log"` makes sure that `y` spans from 0 and +inf

## ✅ Appropriate model

```{r fitP-plot}
#| echo: true
#| code-fold: true

fitP = glm(y~age, family=poisson(link="log"), data=d)

effP = data.frame(allEffects(fitP,xlevels=list(age=seq(min(age),max(age),.05)))$"age")
p1 <- ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effP,aes(y=fit),size=2,color="blue")+
  geom_ribbon(data=effP,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="blue")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

p1 
```

## ✅ Appropriate model (blue one)

```{r fitP-plot2}
#| echo: true
#| code-fold: true
p2 <- ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effP,aes(y=fit),size=2,color="blue")+
  geom_ribbon(data=effP,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="blue")+
  geom_line(data=effL,aes(y=fit),size=2,color="darkred")+
  geom_ribbon(data=effL,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="darkred")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

p1 | p2

```

# 3 Adding an interaction

## Simulated dataset 2

independent variable: age in years (`years`)

dependent variable: mistakes in a reading task (`errors`)

::: fragment
**adding a new main effect**

groups: normal kids (`group = 0`) vs kids with dyslexia (`group = 1`)
:::

## ❌ Identity link function

an interaction would emerge with a classical linear model (commenta l'output) il link è quello identico mettilo nel codice

using the wrong link

```{r fitL_01}
#| echo: true
#| include: true
#| warning: true
fitL_0 = glm(y ~ age + group, data=d)
fitL_1 = glm(y ~ age * group, data=d)
anova(fitL_0, fitL_1, test = "Chisq")
```

## ❌ Identity link function

```{r fitL_01-plot}
#| echo: true
#| code-fold: true

eff_obj <- allEffects(
  fitL_1,
  xlevels = list(age = seq(min(d$age), max(d$age), .05))
)[["age:group"]]

effL <- as.data.frame(eff_obj)

# garantisci colonna fit
if (!("fit" %in% names(effL))) {
  pred_col <- intersect(c("fit", "response", "fitted", "yhat"), names(effL))
  if (length(pred_col) == 0)
    stop("Nessuna colonna di predizione trovata in effL.")
  effL$fit <- effL[[pred_col[1]]]
}

ggplot(d, aes(x = age, y = y, shape = group, color = group)) +
  geom_point(size = 4, alpha = .6) +
  geom_ribbon(
    data = effL,
    aes(x = age, ymin = lower, ymax = upper, fill = group, group = group),
    alpha = .3,
    color = NA,
    inherit.aes = FALSE
  ) +
  geom_line(
    data = effL,
    aes(x = age, y = fit, color = group, group = group),
    linewidth = 2,
    inherit.aes = FALSE
  ) +
  scale_color_manual(values = c("darkorange3", "darkgreen")) +
  scale_fill_manual(values = c("darkorange3", "darkgreen")) +
  theme(text = element_text(size = ts, color = tc)) +
  scale_x_continuous(breaks = seq(6, 10, .5)) +
  labs(y = "Errors", x = "Age (years)")

```

## ✅ Log link function

no significant interaction using the correct link

```{r fitP_01}
#| echo: true
#| include: true
#| warning: false
fitP_0 = glm(y ~ age + group, family=poisson(link="log"), data=d)
fitP_1 = glm(y ~ age * group, family=poisson(link="log"), data=d)
anova(fitP_0, fitP_1)
```

## ✅ Log link function

```{r fitP_01-plot}
#| echo: true
#| code-fold: true

fitP = glm(y~age*group, family=poisson(link="log"), data=d)
effP = data.frame(allEffects(fitP,xlevels=list(age=seq(min(age),max(age),.05)))$"age:group")
effP$group = as.factor(effP$group)
ggplot(d,aes(x=age,y=y,shape=group,color=group))+
  geom_point(size=4,alpha=.6)+
  scale_color_manual(values=c("darkorange2","darkgreen"))+
  scale_fill_manual(values=c("darkorange1","darkgreen"))+
  geom_line(data=effP,aes(x=age,y=fit,group=group,linetype=group),size=2)+
  geom_ribbon(data=effP,aes(x=age,y=fit,ymin=lower,ymax=upper,group=group,fill=group),alpha=.3,color=NA)+
  theme(text=element_text(size=ts,color="black"))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

```

## False positive interactions rate

::::: columns
::: column
✅ correct `link="log"`

→ false positive 

interactions are `r mean(pvals_log < 0.05)*100`%

(about ok)
:::

::: column
```{r loglink-error}
#| echo: false
ggplot(data.frame(p = pvals_log), aes(x = p)) +
  geom_histogram(bins = 30) +
  geom_vline(xintercept = 0.05, linetype = "dashed") +
  labs(
    x = "p-value (interazione age:group)",
    y = "conteggio",
  )
```
:::
:::::

## False positive interactions rate

::::: columns
::: column
❌ incorrect `link="identity"`

→ false positive interactions are `r mean(pvals_id < 0.05)*100`% (baaad!)
:::

::: column
```{r idlink-error}
#| echo: false

ggplot(data.frame(p = pvals_id), aes(x = p)) +
  geom_histogram(bins = 30) +
  geom_vline(xintercept = 0.05, linetype = "dashed") +
  labs(
    x = "p-value (interazione age*group)",
    y = "conteggio")
```
:::
:::::

# Conclusions

## 

there are many link functions (and families of distributions)

use the right one: otherwise it's very likely you end up finding something that is not there!

We're conducting a [systematic review](https://osf.io/tpjax/overview?view_only=7feccf54ff484fe093cf65579617b215) concerning how often the wrong link functions are used in psychological research + they lead to finding a significant interaction: so far, quite often

## Materials & Contact

All materials are available on GitHub at <a href="https://github.com/sitalaura/link-functions.git" target="_blank">sitalaura/link-functions</a>

Questions and feedbacks <a href="mailto: laura.sita@studenti.unipd.it" target="_blank">laura.sita\@studenti.unipd.it</a>

![](images/logo.png){fig-align="center" width="2.4cm"}

## Bibliography

<p style="font-size:70%; text-align:left; line-height:1.2;">
Domingue, B. W., Kanopka, K., Trejo, S., Rhemtulla, M., & Tucker-Drob, E. M. (2024). Ubiquitous bias and false discovery due to model misspecification in analysis of statistical interactions: The role of the outcome’s distribution and metric properties. *Psychological methods, 29*(6), 1164.
</p>

<p style="font-size:70%; text-align:left; line-height:1.2;">
Hardwicke, T. E., Thibault, R. T., Clarke, B., Moodie, N., Crüwell, S., Schiavone, S. R., Handcock, S. A., Nghiem, K. A., Mody, F., Eerola, T., et al. (2024). Prevalence of transparent research practices in psychology: A cross-sectional study of empirical articles published in 2022. *Advances in Methods and Practices in Psychological Science, 7* (4), 25152459241283477.
</p>

<p style="font-size:70%; text-align:left; line-height:1.2;">
Liddell, T. M., & Kruschke, J. K. (2018). Analyzing ordinal data with metric models: What could possibly go wrong?. *Journal of Experimental Social Psychology, 79*, 328-348.
</p>

<p style="font-size:70%; text-align:left; line-height:1.2;">
Micceri, T. (1989). The unicorn, the normal curve, and other improbable creatures. *Psychological bulletin, 105*(1), 156.
</p>

## Thank you

Special thanks to

# Supplementary materials

## wrong family doesnt imply interaction issues

if we put the wrong family, but the correct link `family=gaussian(link="log")` still no interaction (as it should)

```{r sup1a}
#| echo: false
#| eval: true
b0 <- log(mean(d$y))
d$group <- as.factor(d$group)
```

```{r sup1b}
#| echo: true
#| include: true
#| warning: false

fitL_log_0 <- glm(y ~ age + group, family = gaussian(link = "log"), data = d, start = c(b0, 0, 0))

fitL_log_1 <- glm(y ~ age * group, family = gaussian(link = "log"), data = d, start = c(b0, 0, 0, 0))

anova(fitL_log_0, fitL_log_1, test = "Chisq")
```
