---
title: "Are we getting interactions wrong? <br> The role of link functions <br> in psychological research"
authors: "Laura Sità, Margherita Calderan, Tommaso Feraco, <br> Filippo Gambarota, Enrico Toffalini"
format:
  revealjs:
    center: true
    embed-resources: true
    slide-number: true
    footer: "Cognitive Science Arena 2026"
    # theme: night
    output-file: "link-functions.html"
toc: true
execute:
  cache: false
  freeze: false
include-in-header:
  - text: |
      <style>
      /* Titolo slide di copertina */
      #title-slide .title {
        font-size: 1.5em;
       <!-- color: #900000; --> 
      }

      /* Logo nella copertina */
      #title-slide::after {
        content: "";
        display: block;
        background-image: url("images/logo.png");
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
        height: 250px;
        margin-top: 1.5em;
      }

      /* Titoli interni delle slide */
      .reveal h1, .reveal h2, .reveal h3 {
      <!--  color: #900000 !important; -->
      }

      /* Dimensione leggermente minore per h2 */
      .reveal h2 {
        font-size: 1.2em !important;
      }

      /* testo giustificato */
      .reveal p, .reveal li {
        text-align: justify !important;
        text-justify: inter-word;
      }

      /* footer centrato */
       .reveal .slide-footer,
      .reveal .footer,
      .reveal .revealjs-footer {
        position: fixed; left: 0; right: 0; bottom: 10px;
        width: 100%;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        text-align: center !important;
      }
      </style>
---

# 

```{r source}
#| echo: false
#| include: false
source("R/datasim.R")
```

per chi vuole provare a simulare le cose in tempo reale

qr code che manda a questo link https://github.com/sitalaura/link-functions/tree/main/R

oppure scaricare il file a questo percorso `sitalaura.github.io/link-functions/R/datasim.R`

# 1 Example

## Simulated dataset 1

independent variable: age in years (`years`)

dependent variable: (`variabile`)

**aggiungi screenshot dataset**

## Linear model

using the classical linear predictor

```{r ex1fitL}
#| echo: true
#| eval: false
fitL = glm(y~age, data=d)
```

## Linear model

what we dont see it bc its a default parameter but its actually hidden in our code:

```{r fitL-link}
#| echo: true
#| eval: false
#| code-fold: true
fitL_explicit = glm(y~age, family=gaussian(link="identity"), data=d)
```

::: fragment
the model uses family gaussian and the identity link function
:::

::: fragment
**link function** in GLMs transforms (re-map) the linear predictor X

to the appropriate range of the response variable Y
:::

## Identity link function

equal intervals on X correspond to equal intervals on Y

PLOT DELLA RETTA su x ed y metti i nomi delle variabili dell'esempio

# 2 Example

## Simulated dataset 2

independent variable: age in years (`years`)

dependent variable: mistakes in a reading task (`errors`)

**aggiungi screenshot dataset**

## Linear model

using the classical linear predictor

```{r fitL}
#| echo: true
#| eval: false
fitL = glm(y~age, data=d)
```

## Linear model

```{r fitL-plot}
#| echo: true
#| code-fold: true
fitL = glm(y~age, data=d)
effL = data.frame(allEffects(fitL,xlevels=list(age=seq(min(age),max(age),.05)))$"age")
ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effL,aes(y=fit),size=2,color="darkred")+
  geom_ribbon(data=effL,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="darkred")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")
```

## ❌  Wrong link function

IN THE FIRST EXAMPLE an identity link was appropriate bc

-   x (`years`) spans from -inf to +inf

-   y (`boh`) spans from -inf to +inf

::: fragment
here an identity link is NOT appropriate bc

-   x (`years`) spans from -inf to +inf

-   y (`errors`) spans from 0 to +inf
:::

::: notes
family is also wrong but doesnt concern what we're talking about
:::

## ✅  Log link function

equal intervals on X correspond to equal ratios (NOT equal intervals) on Y

PLOT DEL LOGARITMO (O QUELLO APPROPRIATO CON L'ESEMPIO) su x ed y metti i nomi delle variabili dell'esempio

## ✅  Appropriate model

using the appropriate distribution `family=poisson`

and **the appropriate link**

```{r fitP}
#| echo: true
#| eval: false
fitP = glm(y~age, family=poisson(link="log"), data=d)
```

in this case, `link="log"` makes sure that `y` spans from 0 and +inf

## ✅  Appropriate model

```{r fitP-plot}
#| echo: true
#| code-fold: true

fitP = glm(y~age, family=poisson(link="log"), data=d)

effP = data.frame(allEffects(fitP,xlevels=list(age=seq(min(age),max(age),.05)))$"age")
p1 <- ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effP,aes(y=fit),size=2,color="blue")+
  geom_ribbon(data=effP,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="blue")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

p1 
```

## ✅  Appropriate model (blue one)

```{r fitP-plot2}
#| echo: true
#| code-fold: true
p2 <- ggplot(d,aes(x=age,y=y))+
  coord_cartesian(ylim=c(-0.4,max(y))) +
  geom_point(size=4,alpha=.5,color="darkblue")+
  geom_line(data=effP,aes(y=fit),size=2,color="blue")+
  geom_ribbon(data=effP,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="blue")+
  geom_line(data=effL,aes(y=fit),size=2,color="darkred")+
  geom_ribbon(data=effL,aes(y=fit,ymin=lower,ymax=upper),alpha=.3,fill="darkred")+
  theme(text=element_text(size=ts,color="black"))+
  scale_y_continuous(breaks=seq(0,20,2))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

p1 | p2

```

# 3 Adding an interaction

## Simulated dataset 2

independent variable: age in years (`years`)

dependent variable: mistakes in a reading task (`errors`)

::: fragment
**adding a new main effect**

groups: normal kids (`group = 0`) vs kids with dyslexia (`group = 1`)
:::

## ❌  Identity link function

an interaction would emerge with a classical linear model (commenta l'output) il link è quello identico mettilo nel codice

using the wrong link

```{r fitL_01}
#| echo: true
#| include: true
#| warning: true
fitL_0 = glmmTMB(y ~ age + group + (1|id), data=d)
fitL_1 = glmmTMB(y ~ age * group + (1|id), data=d)
anova(fitL_0, fitL_1)
```

## ❌  Identity link function

```{r fitL_01-plot}
#| echo: true
#| code-fold: true

ts <- 16
tc <- "black"

eff_obj <- allEffects(
  fitL_1,
  xlevels = list(age = seq(min(d$age), max(d$age), .05))
)[["age:group"]]

effL <- as.data.frame(eff_obj)

# garantisci colonna fit
if (!("fit" %in% names(effL))) {
  pred_col <- intersect(c("fit", "response", "fitted", "yhat"), names(effL))
  if (length(pred_col) == 0)
    stop("Nessuna colonna di predizione trovata in effL.")
  effL$fit <- effL[[pred_col[1]]]
}

ggplot(d, aes(x = age, y = y, shape = group, color = group)) +
  geom_point(size = 4, alpha = .6) +
  geom_ribbon(
    data = effL,
    aes(x = age, ymin = lower, ymax = upper, fill = group, group = group),
    alpha = .3,
    color = NA,
    inherit.aes = FALSE
  ) +
  geom_line(
    data = effL,
    aes(x = age, y = fit, color = group, group = group),
    linewidth = 2,
    inherit.aes = FALSE
  ) +
  scale_color_manual(values = c("darkorange3", "darkgreen")) +
  scale_fill_manual(values = c("darkorange3", "darkgreen")) +
  theme(text = element_text(size = ts, color = tc)) +
  scale_x_continuous(breaks = seq(6, 10, .5)) +
  labs(y = "Errors", x = "Age (years)")

```

## ✅  Log link function

no significant interaction using the correct link

```{r fitP_01}
#| echo: true
#| include: true
#| warning: false
fitP_0 = glmmTMB(y ~ age + group + (1|id), family=poisson(link="log"), data=d)
fitP_1 = glmmTMB(y ~ age * group + (1|id), family=poisson(link="log"), data=d)
anova(fitP_0, fitP_1)
```

## ✅  Log link function

```{r fitP_01-plot}
#| echo: true
#| code-fold: true

fitP = glm(y~age*group, family=poisson(link="log"), data=d)
effP = data.frame(allEffects(fitP,xlevels=list(age=seq(min(age),max(age),.05)))$"age:group")
effP$group = as.factor(effP$group)
ggplot(d,aes(x=age,y=y,shape=group,color=group))+
  geom_point(size=4,alpha=.6)+
  scale_color_manual(values=c("darkorange2","darkgreen"))+
  scale_fill_manual(values=c("darkorange1","darkgreen"))+
  geom_line(data=effP,aes(x=age,y=fit,group=group,linetype=group),size=2)+
  geom_ribbon(data=effP,aes(x=age,y=fit,ymin=lower,ymax=upper,group=group,fill=group),alpha=.3,color=NA)+
  theme(text=element_text(size=ts,color="black"))+scale_x_continuous(breaks=seq(0,20,.5))+
  ylab("Errors")+xlab("Age (years)")

```

## Huge false positive interactions rate

::: columns
::: column
✅ correct `link="log"`

→ false positive interactions are 3.5% (about ok)
::: 

::: column
```{r}
#| echo: TRUE

```
::: 

::: 

## Huge false positive interactions rate

::: columns
::: column
❌ incorrect `link="identity"`

→ false positive interactions are 76.9% (baaad!)
::: 

::: column
```{r}
#| echo: TRUE

```
::: 

::: 

# Conclusions

## 

there are many link functions (and families of distributions)

use the right one: otherwise it's very likely you end up finding something that is not there!

We're conducting a [systematic review](https://osf.io/tpjax/overview?view_only=7feccf54ff484fe093cf65579617b215) concerning how often the wrong link functions are used in psychological research + they lead to finding a significant interaction: so far, quite often

## Materials & Contact

All materials are available on GitHub at <a href="https://github.com/sitalaura/link-functions.git" target="_blank">sitalaura/link-functions</a>

Questions and feedbacks <a href="mailto: laura.sita@studenti.unipd.it" target="_blank">laura.sita\@studenti.unipd.it</a>

![](images/logo.png){fig-align="center" width="2.4cm"}

## Bibliography

<div style="margin-top:1cm;"></div>
<p style="font-size:70%; text-align:left; line-height:1.2;">
Domingue, B. W., Kanopka, K., Trejo, S., Rhemtulla, M., & Tucker-Drob, E. M. (2024). Ubiquitous bias and false discovery due to model misspecification in analysis of statistical interactions: The role of the outcome’s distribution and metric properties. *Psychological methods, 29*(6), 1164.
</p>

<div style="margin-top:1cm;"></div>
<p style="font-size:70%; text-align:left; line-height:1.2;">
Hardwicke, T. E., Thibault, R. T., Clarke, B., Moodie, N., Crüwell, S., Schiavone, S. R.,
Handcock, S. A., Nghiem, K. A., Mody, F., Eerola, T., et al. (2024). Prevalence of
transparent research practices in psychology: A cross-sectional study of empirical articles
published in 2022. *Advances in Methods and Practices in Psychological Science, 7* (4),
25152459241283477.
</p>

<div style="margin-top:1cm;"></div>
<p style="font-size:70%; text-align:left; line-height:1.2;">
Liddell, T. M., & Kruschke, J. K. (2018). Analyzing ordinal data with metric models: What could possibly go wrong?. *Journal of Experimental Social Psychology, 79*, 328-348.
</p>

<div style="margin-top:1cm;"></div>
<p style="font-size:70%; text-align:left; line-height:1.2;">
Micceri, T. (1989). The unicorn, the normal curve, and other improbable creatures. *Psychological bulletin, 105*(1), 156.
</p>

# Supplementary materials

## wrong family doesnt imply issues

if we put the wrong family, but the correct link `family=gaussian(link="log")` still no interaction (as it should)

```{r sup1a}
#| echo: false
#| eval: true
b0 <- log(mean(d$y))
```

```{r sup1b}
#| echo: true
#| include: true
#| warning: false

fitL_log_0 <- glmmTMB(y ~ age + group + (1|id), family = gaussian(link="log"), data=d, start=list(beta=c(b0, 0, 0)))

fitL_log_1 <- glmmTMB(y ~ age * group + (1|id), family = gaussian(link="log"), data=d, start=list(beta=c(b0, 0, 0, 0)))

anova(fitL_log_0, fitL_log_1)
```
